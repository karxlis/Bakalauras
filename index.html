<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AR</title> 
    <meta name="description" content="test">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="script.js" defer></script>
    <style>
        /* tailwind body styles*/
        body { margin: 0; overflow: hidden; font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"; }
        /* Overlay taisykles*/
        #dom-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; }
        #dom-overlay > * { pointer-events: auto; }
        /* markeris*/
         #placement-reticle { pointer-events: none; }
         #camera-aim-marker > * { pointer-events: none; }
         /* isjungti upgrade btn */
         .upgrade-button:disabled .upgrade-desc-level { display: block; }
         .upgrade-button:not(:disabled) .upgrade-desc-level { display: none; }

    </style>
  </head>
  <body>
    <a-scene
      id="myScene"
      reflection="directionalLight:a-light[type=directional]"
      ar-hit-test="target: #placement-reticle; type: footprint;"
      renderer="physicallyCorrectLights:true;colorManagement:true;exposure:1;toneMapping:ACESFilmic;"
      webxr="overlayElement:#dom-overlay; optionalFeatures: hit-test, dom-overlay, anchors;"
      cursor__mouse="rayOrigin: mouse;"
      cursor__xr="rayOrigin: controller;"
      raycaster="objects: .interactive;"
      vr-mode-ui="enterARButton: #myEnterARButton"
      background="color: #ECECEC;"
    >
     
        <a-assets>
            <a-mixin id="cursor_animations"
              animation__mouseenter="property: scale; to: 1.2 1.2 1.2; startEvents: mouseenter; dur: 200"
              animation__mouseleave="property: scale; to: 1 1 1; startEvents: mouseleave; dur: 200"
              animation__jump="startEvents:click;property:object3D.position.y;from: 0.5; to: 0.8; dir:alternate;loop:1;easing:easeOutQuad;dur:300;">
            </a-mixin>
          </a-assets>

          <a-light type="directional" light="castShadow:true;" position="1 1 1" intensity="0.5" shadow-camera-automatic=".interactive"></a-light>
          <a-light type="ambient" intensity="0.6"></a-light>

          <a-camera id="player-camera" position="0 0.4 0" wasd-controls="enabled: false;">
            <a-entity id="camera-aim-marker" position="0 -0.1 -1.5">
                 <a-ring color="white" radius-inner="0.01" radius-outer="0.02"></a-ring>
            </a-entity>
          </a-camera>

          <a-entity id="objects" scale="0.2 0.2 0.2" position="0 0 -1" visible="true">
            <a-entity id="enemies"></a-entity>
          </a-entity>

          <a-plane follow-shadow="#objects" material="shader:shadow; transparent: true; opacity: 0.4;" shadow="cast:false; receive:true" rotation="-90 0 0" width="30" height="30"></a-plane>

          <a-sky color="#ECECEC" hide-on-enter-ar></a-sky>

          <a-entity id="placement-reticle" visible="false">
             <a-ring radius-inner="0.02" radius-outer="0.03" color="lightblue" rotation="-90 0 0"></a-ring>
          </a-entity>
    </a-scene>

       <section id="dom-overlay" class="text-cyan-100 text-sm select-none"> 

            <div id="tower-health-indicator" class="absolute top-4 left-4 bg-gray-900 bg-opacity-80 backdrop-blur-sm rounded-md p-3 px-4 font-semibold border border-cyan-500/30 shadow-lg hidden">
            
            </div>

            <div id="scanning-feedback" class="absolute top-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-75 text-white py-2 px-4 rounded-md text-center whitespace-pre pointer-events-none hidden shadow-md">
            
            </div>

            <div id="level-up-popup" class="absolute top-1/3 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-gradient-to-br from-green-500 to-cyan-600 text-white p-5 px-7 rounded-lg border border-white/50 text-center z-30 pointer-events-none hidden text-xl shadow-xl backdrop-blur-sm">
              <div class="level-up-text font-bold text-2xl mb-1 tracking-wide">LEVEL UP!</div>
              <div id="level-number" class="text-lg opacity-90">Level: 1</div>
            </div>

            <div id="place-tower-popup"
            class="absolute top-4 left-1/2 transform -translate-x-1/2 w-11/12 max-w-sm  /* poz */
                   bg-gradient-to-b from-slate-900/95 to-black/95 backdrop-blur-lg /* gradientas */
                   border border-cyan-500/40 rounded-lg                 /* Cyan border */
                   z-20 p-5                                             /* Z-index, padding */
                   text-center text-slate-300                           /* Base text color */
                   shadow-lg shadow-cyan-900/20                         /* Shadow */
                   hidden                                              
                   ">
 
    
         <div class="font-bold text-lg text-cyan-300 tracking-wide mb-2">
           Padėkite bokšta prieš save.
         </div>
 
  
         <div class="text-sm mb-4 opacity-90">
           Paspausk betkur ant paviršiaus
         </div>
 
  
         <button id="startGameButton"
                 disabled
                 class="bg-cyan-600 hover:bg-cyan-500 active:scale-95 text-slate-900 font-bold py-2 px-5 rounded shadow-md transition duration-150 ease-in-out disabled:bg-slate-600 disabled:text-slate-400 disabled:cursor-not-allowed">
           Pradėti.
         </button>

         <div id="tower-placed-feedback" class="text-xs mt-3 text-green-400 font-semibold hidden">
           Pakeiskite poziciją arba pradėkite žaidimą.
         </div>
       </div>

            <div id="upgrades-popup" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-gray-900 bg-opacity-90 backdrop-blur-md border border-cyan-500/30 rounded-lg z-40 p-6 text-center hidden min-w-[360px] shadow-xl"> 
              <h2 class="mt-0 mb-4 text-cyan-300 text-xl font-bold tracking-wide">Level Up! Choose Upgrade:</h2>
              <div class="grid grid-cols-2 gap-4 mb-4">
              
                <button id="upgradeShooter" class="upgrade-button relative overflow-hidden bg-cyan-700 hover:bg-cyan-600 text-white font-semibold py-3 px-2 rounded text-sm min-w-[150px] flex flex-col items-center justify-center h-24 transition duration-150 ease-in-out border border-cyan-600 hover:border-cyan-500 disabled:bg-gray-700 disabled:text-gray-500 disabled:border-gray-600 disabled:opacity-70 disabled:cursor-not-allowed">
                    <span>ŠAUDYTOJAS</span>
                    <span class="upgrade-desc block text-xs mt-1 opacity-80 font-normal"></span>
                    <span class="upgrade-desc-level absolute bottom-1 text-xs text-amber-400 font-semibold hidden"></span> 
                </button>
                <button id="upgradeHealth" class="upgrade-button relative overflow-hidden bg-cyan-700 hover:bg-cyan-600 text-white font-semibold py-3 px-2 rounded text-sm min-w-[150px] flex flex-col items-center justify-center h-24 transition duration-150 ease-in-out border border-cyan-600 hover:border-cyan-500 disabled:bg-gray-700 disabled:text-gray-500 disabled:border-gray-600 disabled:opacity-70 disabled:cursor-not-allowed">
                    <span>BOKŠTO GYVYBĖ</span>
                    <span class="upgrade-desc block text-xs mt-1 opacity-80 font-normal">(+3 Max HP)</span>
                    <span class="upgrade-desc-level absolute bottom-1 text-xs text-amber-400 font-semibold hidden"></span>
                </button>
                <button id="upgradeSlower" class="upgrade-button relative overflow-hidden bg-cyan-700 hover:bg-cyan-600 text-white font-semibold py-3 px-2 rounded text-sm min-w-[150px] flex flex-col items-center justify-center h-24 transition duration-150 ease-in-out border border-cyan-600 hover:border-cyan-500 disabled:bg-gray-700 disabled:text-gray-500 disabled:border-gray-600 disabled:opacity-70 disabled:cursor-not-allowed">
                    <span>LĖTINTOJAS</span>
                    <span class="upgrade-desc block text-xs mt-1 opacity-80 font-normal"></span>
                    <span class="upgrade-desc-level absolute bottom-1 text-xs text-amber-400 font-semibold hidden"></span>
                </button>
                <button id="upgradePlayerDamage" class="upgrade-button relative overflow-hidden bg-cyan-700 hover:bg-cyan-600 text-white font-semibold py-3 px-2 rounded text-sm min-w-[150px] flex flex-col items-center justify-center h-24 transition duration-150 ease-in-out border border-cyan-600 hover:border-cyan-500 disabled:bg-gray-700 disabled:text-gray-500 disabled:border-gray-600 disabled:opacity-70 disabled:cursor-not-allowed">
                    <span>ŽALA</span>
                    <span class="upgrade-desc block text-xs mt-1 opacity-80 font-normal">(+15% Player Damage)</span>
                    <span class="upgrade-desc-level absolute bottom-1 text-xs text-amber-400 font-semibold hidden"></span>
                </button>
              </div>
              <button id="closeUpgradePopupButton" class="mt-6 py-2 px-5 bg-gray-600 hover:bg-gray-500 text-cyan-100 rounded transition duration-150 ease-in-out">Uždaryti</button>
            </div>

            <div id="confirm-placement-area" class="absolute top-4 left-1/2 transform -translate-x-1/2 z-30 hidden">
              <button id="confirmPlacementButton" class="bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-2 px-5 rounded shadow-md transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed">Patvirtinti</button>
            </div>

            <div id="game-over-screen" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black bg-opacity-80 backdrop-blur-md border border-red-500/50 rounded-lg z-50 p-8 text-center hidden shadow-xl">
              <h2 class="mt-0 text-red-400 text-2xl font-bold tracking-wide">PABAIGA/h2>
              <p id="final-score" class="text-lg my-6 text-cyan-100">TAVO TAŠKAI: 0</p>
              <button id="tryAgainButton" class="py-3 px-6 text-lg bg-cyan-600 hover:bg-cyan-500 text-gray-900 rounded cursor-pointer transition duration-150 ease-in-out shadow">Pabandyk iš naujo</button>
            </div>

            <div id="controls-widget" class="absolute bottom-4 left-4 right-4 md:left-auto md:right-auto md:w-auto bg-slate-900 bg-opacity-80 backdrop-blur-md rounded-md p-3 z-10 border border-cyan-600/40 shadow-lg text-center md:text-left"> 

             
              <div class="flex justify-center md:justify-start gap-4 mb-3 px-2">
                  <div id="score-display" class="text-base font-semibold text-cyan-300 opacity-95">Score: 0</div>
                  <div id="level-display" class="text-base font-semibold text-cyan-300 opacity-95">Level: 1</div>
              </div>
      
            
              <fieldset class="border-none p-0 flex justify-center items-center gap-3"> 
                  
                   <button
                      id="myEnterARButton"
                      onclick="console.log('Enter AR Button'); document.querySelector('a-scene').enterAR()"
                      class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-5 rounded shadow-md transition duration-150 ease-in-out active:scale-95">
                      Eiti į AR
                  </button>
                 
                  <button id="exitVRButton" class="bg-slate-600 hover:bg-slate-500 text-white font-bold py-2 px-4 rounded shadow-md transition duration-150 ease-in-out active:scale-95 hidden">Exit</button>
      
                 
                  <button id="shootButton" class="bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-3 px-6 rounded-lg shadow-lg transition duration-100 ease-in-out transform active:scale-90 disabled:opacity-50 disabled:cursor-not-allowed">Šauk</button> 
      
              
                  <button id="manualUpgradesButton" class="bg-purple-600 hover:bg-purple-500 text-white font-bold py-2 px-4 rounded shadow-md transition duration-150 ease-in-out active:scale-95">Upgradai</button>
               </fieldset>
            </div>
      </section> </body>
</html>