<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AR Placement & Shooting Combined v2 â€¢ A-Frame</title>
    <meta name="description" content="Place cubes via hit-test or shoot projectiles towards camera marker.">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- A-Frame Core -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <!-- A-Frame Extras (for draggable, etc.) -->
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>

    <!-- Link to external CSS -->
    <link rel="stylesheet" href="style.css">

    <!-- Link to external JavaScript - 'defer' ensures it runs after HTML parsing -->
    <script src="script.js" defer></script>
  </head>
  <body>
    <!-- Scene Setup: Attributes here, logic in JS -->
    <a-scene
      id="myScene"
      reflection="directionalLight:a-light[type=directional]"
      ar-hit-test="target: #placement-reticle; type: footprint;"
      renderer="physicallyCorrectLights:true;colorManagement:true;exposure:1;toneMapping:ACESFilmic;"
      webxr="overlayElement:#dom-overlay; optionalFeatures: hit-test, dom-overlay;"
      cursor__mouse="rayOrigin: mouse;"
      cursor__xr="rayOrigin: controller;"
      raycaster="objects: .interactive;"
      vr-mode-ui="enterARButton: #myEnterARButton"
      background="color: #ECECEC;"
    >
      <!-- Assets -->
      <a-assets>
        <a-mixin id="cursor_animations"
          animation__mouseenter="property: scale; to: 1.2 1.2 1.2; startEvents: mouseenter; dur: 200"
          animation__mouseleave="property: scale; to: 1 1 1; startEvents: mouseleave; dur: 200"
          animation__jump="startEvents:click;property:object3D.position.y;from: 0.5; to: 0.8; dir:alternate;loop:1;easing:easeOutQuad;dur:300;">
        </a-mixin>
      </a-assets>

      <!-- Lighting -->
      <a-light type="directional" light="castShadow:true;" position="1 1 1" intensity="0.5" shadow-camera-automatic=".interactive"></a-light>
      <a-light type="ambient" intensity="0.6"></a-light>

      <!-- Camera with Aiming Marker -->
<!-- Camera with Aiming Marker -->
<a-camera id="player-camera" position="0 0.4 0" wasd-controls="enabled: false;">
  <a-entity id="camera-aim-marker" position="0 -0.1 -1.5">
       <a-ring color="white" radius-inner="0.01" radius-outer="0.02"></a-ring>
  </a-entity>
</a-camera>

<!-- Initial Objects -->
<a-entity id="objects" scale="0.2 0.2 0.2" position="0 0 -1" visible="true">
  <!-- Original Objects -->
  <a-box class="interactive" mixin="cursor_animations" position="-1 0.5 1" rotation="0 45 0" color="#4CC3D9" attach-dom-element="#box-label" shadow draggable></a-box>
  <a-sphere class="interactive" mixin="cursor_animations" position="0 1.25 -1" radius="1.25" color="#EF2D5E" attach-dom-element="#sphere-label" shadow draggable></a-sphere>
  <a-cylinder id="target-cylinder" class="interactive" mixin="cursor_animations" position="1 0.75 1" radius="0.5" height="1.5" color="#FFC65D" attach-dom-element="#cylinder-label" shadow draggable></a-cylinder>

  <!-- **** Orbiting BOXES **** -->
  <a-box id="orbit-box1" class="orbiting-target" 
    width="0.5" height="0.5" depth="0.5"
    material="color: #FFDB58; shader: standard;"
    hit-receiver 
    start-orbit-in-ar="radius: 3; speed: 0.6; initialAngle: 0;">
</a-box>
<a-box id="orbit-box2" class="orbiting-target" 
    width="0.4" height="0.4" depth="0.4"
    material="color: #C3B1E1; shader: standard;"
    hit-receiver 
    start-orbit-in-ar="radius: 3.5; speed: -0.4; initialAngle: 1.57;">
</a-box>
<a-box id="orbit-box3" class="orbiting-target" 
    width="0.6" height="0.6" depth="0.6"
    material="color: #90EE90; shader: standard;"
    hit-receiver 
    start-orbit-in-ar="radius: 2.8; speed: 0.7; initialAngle: 3.14;">
</a-box>
   <!-- Add more boxes if desired -->

</a-entity>

<!-- Shadow Plane -->
<a-plane follow-shadow="#objects" material="shader:shadow; transparent: true; opacity: 0.4;" shadow="cast:false; receive:true" rotation="-90 0 0" width="30" height="30"></a-plane>
<!-- Sky -->
<a-sky color="#ECECEC" hide-on-enter-ar></a-sky>

<!-- Placement Reticle -->
<a-entity id="placement-reticle" visible="false">
   <a-ring radius-inner="0.02" radius-outer="0.03" color="lightblue" rotation="-90 0 0"></a-ring>
</a-entity>

<!-- **** ADD SINGLE STATIC PYRAMID **** -->


</a-scene> <!-- End of A-Frame Scene -->

      <!-- Shadow Plane -->
      <a-plane follow-shadow="#objects" material="shader:shadow; transparent: true; opacity: 0.4;" shadow="cast:false; receive:true" rotation="-90 0 0" width="30" height="30"></a-plane>
      <!-- Sky -->
      <a-sky color="#ECECEC" hide-on-enter-ar></a-sky>

      <!-- Placement Reticle -->
      <a-entity id="placement-reticle" visible="false">
         <a-ring radius-inner="0.02" radius-outer="0.03" color="lightblue" rotation="-90 0 0"></a-ring>
      </a-entity>

    </a-scene> <!-- End of A-Frame Scene -->

    <!-- DOM Overlay -->
    <section id="dom-overlay" class="hide-labels">
       <div id="scanning-feedback">Scanning for surfaces...<br>Move phone slowly.</div>
       <div id="controls-widget" style="inset:auto auto 1em 1em;" class="overlay-widget">
        <h1 style="margin: 0 0 0.5em 0;">My 3D Life</h1>
        <div id="score-display" style="margin-bottom: 1em; font-size: 1.1em; font-weight: bold;">Score: 0</div>
        <fieldset style="border:none; padding: 0; margin-bottom: 0.5em;"><legend>Sphere Color</legend> <input onclick="toggleSphereColor(this)" type="radio" id="red" name="sphereColor" value="#EF2D5E" checked><label for="red"> Red</label> <input onclick="toggleSphereColor(this)" type="radio" id="blue" name="sphereColor" value="#4CC3D9"><label for="blue"> Blue</label></fieldset>
        <fieldset style="border:none; padding: 0; margin-bottom: 0.5em;"><legend>Show Labels</legend> <input onclick="toggleLabels(this)" type="radio" id="no" name="labelsVisible" value="no" checked><label for="no"> Hide</label> <input onclick="toggleLabels(this)" type="radio" id="yes" name="labelsVisible" value="yes"><label for="yes"> Show</label></fieldset>
        <fieldset style="border:none; padding: 0; margin-bottom: 0.5em;"><legend>Interaction Mode</legend> <input type="checkbox" id="placementModeCheckbox"><label for="placementModeCheckbox">Enable Cube Placement</label> <div style="font-size: 0.8em; margin-top: 0.3em;">(Tap screen to place at blue marker)</div></fieldset>
        <fieldset style="border:none; padding: 0;">
            <button id="myEnterARButton" onclick="document.querySelector('a-scene').enterAR()">Enter AR</button>
            <button id="exitVRButton" onclick="AFRAME.scenes[0].exitVR()" style="display: none;">Exit Immersive</button>
            <button id="shootButton">Shoot</button>
         </fieldset>
      </div>
      <div id="sphere-label" class="xr-select-through overlay-widget" style="pointer-events: none;">A red sphere</div>
      <div id="box-label" class="xr-select-through overlay-widget" style="pointer-events: none;">A blue box</div>
      <div id="cylinder-label" class="xr-select-through overlay-widget" style="pointer-events: none;">A yellow cylinder</div>
    </section> <!-- End of DOM Overlay -->

  </body>
</html>